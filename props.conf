[WMI:WinEventLog:Security]
#######SOC Parsing ########
REPORT-search = windows_active_directory1,windows_active_directory2,ad_field_extract_0,ad_field_extract_1, ad_field_extract_2, ad_field_extract_3,ad_field_extract_3_1,ad_field_extract_3_2, ad_field_extract_4, ad_field_extract_5, ad_field_extract_6,ad_field_extract_7, ad_field_extract_8, ad_field_extract_9, ad_field_extract_11, ad_field_extract_12, ad_field_extract_13, ad_field_extract_14, ad_field_extract_15, ad_field_extract_16,ad_field_extract_17, ad_field_extract_18, ad_field_extract_19,ad_field_extract_20,ad_field_extract_21, ad_field_extract_22,ad_field_extract_23,ad_field_extract_24,ad_field_extract_25,ad_field_extract_26,ad_field_extract_27,ad_field_extract_28
EVAL-event_date = strptime(case(raw_month="一" OR raw_month="Jan", 1, raw_month="二" OR raw_month="Feb", 2, raw_month="三" OR raw_month="Mar",3, raw_month="四" OR raw_month="Apr",4, raw_month="五" OR raw_month="May",5, raw_month="六" OR raw_month="Jun",6, raw_month="七" OR raw_month="Jul",7, raw_month="八" OR raw_month="Aug",8, raw_month="九" OR raw_month="Sep",9, raw_month="十" OR raw_month="Oct",10, raw_month="十一" OR raw_month="Nov",11, raw_month="十二" OR raw_month="Dec" ,12)." ".raw_date , "%m %d %H:%M:%S")
EVAL-vendor = "Microsoft"
EVAL-src_zone = if(src_zone="登入識別碼:" OR src_zone="服務名稱:" OR  src_zone="失敗資訊:"" OR src_zone="登入類型:" OR src_zone="登入","",src_zone)

EVAL-parameter = case(raw_event_id="5136" OR raw_event_id="5145" OR raw_event_id="5142","帳戶名稱:".src_user." 來源網域:".src_zone." ".msg,raw_event_id="1100","主機".dest_dns."事件記錄服務已關閉, 事件ID: 1100",raw_event_id="4697","帳戶名稱:".src_host." 來源>網域:".src_zone2." 服務名稱:".Service_name." 服務檔案名稱:".Service_file,raw_event_id="4729" OR raw_event_id="4733" OR raw_event_id="4757","刪除來源帳號/主機:".src_user." 來源網域:".src_zone." 目的帳號:".user."  群組名稱:".group_name."  事件ID:".raw_event_id,raw_event_id="4728" OR raw_event_id="4732" OR raw_event_id="4756","新增來源帳號/主機:".src_user." 來源網域:".src_zone." 目的帳號 :".user."  群組名稱:".group_name."  事件ID:".raw_event_id,raw_event_id="4726","刪除來源帳號/主機:".src_user." 來源網域:".src_zone." 目的帳號:".user."  事件ID:".raw_event_id,raw_event_id="4720","新增來源帳號/主機:".src_user." 來源網域:".src_zone." 目的帳號:".user."  事件ID:".raw_event_id,isnotnull(logon_process) AND isnotnull(src_user) AND isnotnull(src_zone),"來源帳號:".src_user." 來>源網域:".src_zone." 處理程序:".logon_process." 事件ID: ".raw_event_id,isnotnull(logon_process) AND isnotnull(src_user) AND isnull(src_zone),"來源帳號:".src_user." 來源網域:  處理程序:".logon_process." 事件ID: ".raw_event_id,isnotnull(logon_process) AND isnull(src_user) AND isnull(src_zone) AND isnull(src_zone2),"來源帳號:  來源網域:  處理程序:".logon_process." 事件ID: ".raw_event_id,isnotnull(logon_process) AND isnull(src_user) AND isnull(src_zone) AND isnotnull(src_zone2),"帳戶名稱:".src_host." 來源網域:  處理 程序:".logon_process." 事件ID: ".raw_event_id,isnull(logon_process) AND isnotnull(src_user) AND isnotnull(src_zone) AND isnotnull(group_name),"來源帳號:".src_user." 來源網域:".src_zone." 群組名稱:".group_name." 事件ID: ".raw_event_id,isnull(logon_process) AND isnotnull(src_user) AND isnotnull(src_zone) AND isnull(group_name),"來源帳號:".src_user." 來源網域:".src_zone." 事件ID: ".raw_event_id,isnull(logon_process) AND isnotnull(src_user) AND isnull(src_zone) AND isnotnull(group_name),"來源帳號:".src_user." 來源>網域: 群組名稱:".group_name." 事件ID: ".raw_event_id,isnull(logon_process) AND isnotnull(src_user) AND isnull(src_zone) AND isnull(group_name),"來源帳號:".src_user." 來源網域:  事件ID: ".raw_event_id,isnull(logon_process) AND isnull(src_user) AND isnotnull(src_zone) AND isnotnull(group_name),"帳戶名稱:".src_host." 來源網域:".src_zone." 群組名稱:".group_name." 事件ID:".raw_event_id,isnull(logon_process) AND isnull(src_user) AND isnotnull(src_zone) AND isnull(group_name),"帳戶名稱:".src_host." 來源網域:".src_zone."  事件ID: ".raw_event_id,isnull(logon_process) AND isnull(src_user) AND isnull(src_zone) AND isnotnull(group_name),"帳戶名稱:".src_host." 來源網域: 群組名稱:".group_name." 事件ID: ".raw_event_id,isnull(logon_process) AND isnull(src_user) AND isnull(src_zone) AND isnull(group_name),"帳戶名稱:".src_host." 來源網域:  事件ID: ".raw_event_id)
ID: ".raw_event_id,isnull(logon_process) AND isnull(src_user) AND isnotnull(src_zone) AND isnotnull(group_name),"帳戶名稱:".src_host." 來源網域:".src_zone." 群組名稱:".group_name." 事件ID:".raw_event_id,isnull(logon_process) AND isnull(src_user) AND isnotnull(src_zone) AND isnull(group_name),"帳戶名稱:".src_host." 來源網域:".src_zone."  事件ID: ".raw_event_id,isnull(logon_process) AND isnull(src_user) AND isnull(src_zone) AND isnotnull(group_name),"帳戶名稱:".src_host." 來源網域: 群組名稱:".group_name." 事件ID: ".raw_event_id,isnull(logon_process) AND isnull(src_user) AND isnull(src_zone) AND isnull(group_name),"帳戶名稱:".src_host." 來>源網域:  事件ID: ".raw_event_id)
LOOKUP-windows:ad:os :LOOKUP-action_mapping = soc_action_mapping raw_action AS action OUTPUT action AS action
LOOKUP-windows:ad:os :LOOKUP-result_code_mapping = soc_result_code_mapping result_code AS result_code OUTPUTNEW Substate AS substate
LOOKUP-soc_windows_ad_signature_mapping = soc_windows_ad_signature_mapping raw_event_id AS raw_event_id OUTPUTNEW signature AS signature
EVAL-signature = raw_event_id.": ".raw_signature

###################################################
########## Universal Forwarder Format ##############
#
FIELDALIAS-for_wineventlog = EventCode AS raw_event_id
FIELDALIAS-dest_dns_for_WinEventLog:Security = ComputerName AS dest_dns
EVAL-src = coalesce(src,src_host)
EVAL-logon_type = case(logon_type="2",logon_type."：本地登錄",logon_type="3",logon_type."：網絡登錄",logon_type="4",logon_type.">：計劃任務",logon_type="5",logon_type."：服務",logon_type="10",logon_type."：遠程登錄",logon_type="7",logon_type."：解除屏幕鎖定",logon_type="8",logon_type."：網絡明文登錄",logon_type="9",logon_type."：新身份登錄",logon_type="11",logon_type."：緩存登錄")
#EVAL-src_user = if(isnull(src_user),mvindex('帳戶名稱',1),src_user)
#
[host::DC07.ski.ad]
EVAL-dvc = "192.168.54.7"
EVAL-dvc_ip = "192.168.54.7"


###### Host Inventory ######
[WinHostMon]
EVAL-mem_free_percent = if(Type=="OperatingSystem", if(isNull(TotalPhysicalMemoryKB), null(), if(isNull(FreePhysicalMemoryKB), null(), FreePhysicalMemoryKB/TotalPhysicalMemoryKB * 100)), null())
EVAL-mem_used = if(Type=="OperatingSystem", if(isNull(TotalPhysicalMemoryKB), null(), if(isNull(FreePhysicalMemoryKB), null(), (TotalPhysicalMemoryKB - FreePhysicalMemoryKB)/1024)), null())
EVAL-mem_used_percent = if(Type=="OperatingSystem", if(isNull(TotalPhysicalMemoryKB), null(), if(isNull(FreePhysicalMemoryKB), null(), (TotalPhysicalMemoryKB - FreePhysicalMemoryKB)/TotalPhysicalMemoryKB * 100)), null())
EVAL-os = if(Type=="OperatingSystem", OS, null())
EVAL-family = if(Type=="Processor", Architecture, null())
EVAL-version = if(Type=="OperatingSystem", Version, null())
EVAL-cpu_cores = if(Type=="Processor", NumberOfCores, null())
EVAL-cpu_count = if(Type=="Processor", NumberOfProcessors, null())
EVAL-cpu_mhz = if(Type=="Processor", ClockSpeedMHz, null())
EVAL-mem = if(Type=="OperatingSystem", TotalPhysicalMemoryKB/1024, null())
EVAL-vendor_product = if(Type=="OperatingSystem", OS, null())
EVAL-mount = if (Type=="Disk", Name, null())
EVAL-storage = if (Type=="Disk", TotalSpaceKB/1024, null())
EVAL-storage_free = if (Type=="Disk", FreeSpaceKB/1024, null())
EVAL-storage_used = if (Type=="Disk", (TotalSpaceKB-FreeSpaceKB)/1024, null())
EVAL-storage_free_percent = if (Type=="Disk", (FreeSpaceKB*100)/TotalSpaceKB, null())
EVAL-storage_used_percent = if (Type=="Disk", ((TotalSpaceKB-FreeSpaceKB)*100)/TotalSpaceKB, null())
EVAL-status = case(Type=="OperatingSystem", Status, Type=="Service", State, 1=1, null())
EVAL-serial = if(Type=="OperatingSystem", SerialNumber, null())
EVAL-description = if(Type=="Processor", Name, null())
EVAL-mem_free = if(Type=="OperatingSystem",if(isNull(FreePhysicalMemoryKB), null(), (FreePhysicalMemoryKB)/1024), null())
EVAL-cpu_architecture = if(Type=="Processor", Architecture, null())
REPORT-System_Type_for_WinHostMon_computer = System_Type_for_WinHostMon_computer
REPORT-Processor_Id_for_WinHostMon_processor = Processor_Id_for_WinHostMon_processor
REPORT-Path_for_WinHostMon_service = Path_for_WinHostMon_service

FIELDALIAS-dest_for_winhostmon = host as dest
EXTRACT-process_for_winhostmon = Type=Process.*?Name="(?<process>[^"}}\{\{]+)"
EXTRACT-service_for_winhostmon = DisplayName="(?<service>[^"}}\{\{]+)"
EVAL-start_mode = lower(StartMode)
FIELDALIAS-host_for_WinHostMon = ComputerName AS host
